<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Copy/Paste Detector Report</title><link href="styles/tailwind.css" rel="stylesheet"><link href="styles/prism.css" rel="stylesheet"></head><body class="bg-gray-100"><header class="bg-white shadow py-4"><div class="container mx-auto px-4"><h1 class="text-3xl font-semibold text-gray-800">jscpd - copy/paste report</h1></div></header><main class="container mx-auto my-8 p-4 bg-white shadow rounded"><section class="mb-8" id="dashboard"><h2 class="text-2xl font-semibold text-gray-700 mb-4">Dashboard</h2><div class="grid grid-cols-4 gap-4"><div class="bg-blue-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-blue-800 mb-2">Total Files</h3><span class="text-4xl font-bold text-blue-800">124</span></div><div class="bg-green-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-green-800 mb-2">Total Lines of Code</h3><span class="text-4xl font-bold text-green-800">17160</span></div><div class="bg-yellow-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-yellow-800 mb-2">Number of Clones</h3><span class="text-4xl font-bold text-yellow-800">10</span></div><div class="bg-red-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-red-800 mb-2">Duplicated Lines</h3><span class="text-4xl font-bold text-red-800">631 (3.68%)</span></div></div></section><section class="mb-8" id="formats"><h2 class="text-2xl font-semibold text-gray-700 mb-4">Formats with Duplications</h2><table class="w-full table-auto"><thead><tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal"><th class="py-3 px-6 text-left">Format</th><th class="py-3 px-6 text-left">Files</th><th class="py-3 px-6 text-left">Lines</th><th class="py-3 px-6 text-left">Clones</th><th class="py-3 px-6 text-left">Duplicated Lines</th><th class="py-3 px-6 text-left">Duplicated Tokens</th></tr></thead><tbody><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#javascript-clones">javascript</a></td><td class="py-3 px-6">85</td><td class="py-3 px-6">9171</td><td class="py-3 px-6">7</td><td class="py-3 px-6">545</td><td class="py-3 px-6">6155</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#jsx-clones">jsx</a></td><td class="py-3 px-6">39</td><td class="py-3 px-6">7989</td><td class="py-3 px-6">3</td><td class="py-3 px-6">86</td><td class="py-3 px-6">750</td></tr></tbody></table></section><section class="mb-8" id="txt-clones"><a name="javascript-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">javascript</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">client\src\pages\ManageLessons.jsx (Line 371:3 - Line 672:17), client\src\pages\MyLessons.jsx (Line 42:3 - Line 259:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn0" onclick="toggleCodeBlock('cloneGroup0', 'expandBtn0', 'collapseBtn0')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn0" onclick="toggleCodeBlock('cloneGroup0', 'expandBtn0', 'collapseBtn0')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup0"><code class="language-javascript text-sm text-gray-800">={{ height: &quot;100%&quot; }}&gt;
      &lt;CardContent&gt;
        &lt;Typography variant=&quot;subtitle1&quot; sx={{ fontWeight: 600 }}&gt;
          {lesson.title}
        &lt;/Typography&gt;
        &lt;Typography variant=&quot;body2&quot; sx={{ mt: 0.5 }}&gt;
          {start.toLocaleString()} — {end.toLocaleString()} ({dur}m)
        &lt;/Typography&gt;

        &lt;Divider sx={{ my: 1.5 }} /&gt;

        &lt;Typography variant=&quot;body2&quot;&gt;
          &lt;strong&gt;Teacher:&lt;/strong&gt;{&quot; &quot;}
          {lesson.teacherId?.name || lesson.teacherId?.email || &quot;—&quot;}
        &lt;/Typography&gt;
        &lt;Typography variant=&quot;body2&quot;&gt;
          &lt;strong&gt;Student:&lt;/strong&gt;{&quot; &quot;}
          {lesson.studentId?.name || lesson.studentId?.email || &quot;—&quot;}
        &lt;/Typography&gt;
        &lt;Typography variant=&quot;body2&quot; sx={{ mt: 0.5 }}&gt;
          &lt;strong&gt;Status:&lt;/strong&gt; {lesson.status}
        &lt;/Typography&gt;

        {lesson.attended &amp;&amp; (
          &lt;Chip label=&quot;Attended&quot; size=&quot;small&quot; color=&quot;success&quot; sx={{ mt: 1 }} /&gt;
        )}
      &lt;/CardContent&gt;

      &lt;CardActions sx={{ px: 2, pb: 2 }}&gt;
        &lt;Tooltip title={isPast ? &quot;Past lessons can’t be edited&quot; : &quot;&quot;} disableHoverListener={!isPast}&gt;
          &lt;span&gt;
            &lt;Button size=&quot;small&quot; variant=&quot;outlined&quot; onClick={() =&gt; onEdit(lesson)} disabled={isPast}&gt;
              Edit
            &lt;/Button&gt;
          &lt;/span&gt;
        &lt;/Tooltip&gt;

        &lt;Tooltip title={isPast ? &quot;Past lessons can’t be edited&quot; : &quot;&quot;} disableHoverListener={!isPast}&gt;
          &lt;span&gt;
            &lt;Button size=&quot;small&quot; onClick={() =&gt; onToggleComplete(lesson)} disabled={isPast}&gt;
              {lesson.status === &quot;completed&quot; ? &quot;Mark Scheduled&quot; : &quot;Mark Completed&quot;}
            &lt;/Button&gt;
          &lt;/span&gt;
        &lt;/Tooltip&gt;

        &lt;Button size=&quot;small&quot; variant=&quot;outlined&quot; onClick={() =&gt; onToggleAttended(lesson)}&gt;
          {lesson.attended ? &quot;Unmark Attended&quot; : &quot;Mark Attended&quot;}
        &lt;/Button&gt;

        &lt;Tooltip title={isPast ? &quot;Past lessons can’t be deleted&quot; : &quot;&quot;} disableHoverListener={!isPast}&gt;
          &lt;span&gt;
            &lt;Button size=&quot;small&quot; color=&quot;error&quot; onClick={() =&gt; onDelete(lesson._id)} disabled={isPast}&gt;
              Delete
            &lt;/Button&gt;
          &lt;/span&gt;
        &lt;/Tooltip&gt;
      &lt;/CardActions&gt;
    &lt;/Card&gt;
  );
}

/* =============================================================================
   Page: ManageLessons
============================================================================= */
export default function ManageLessons() {
  // ---------------------------------------------------------------------------
  // Auth context (used for role gating + passing default teacherId)
  // ---------------------------------------------------------------------------
  const role = (localStorage.getItem(&quot;role&quot;) || &quot;&quot;).toLowerCase();
  const currentUserId = localStorage.getItem(&quot;userId&quot;) || &quot;&quot;; // optional; pass to Recurring dialog

  // ---------------------------------------------------------------------------
  // Data &amp; UI state
  // ---------------------------------------------------------------------------
  const [allLessons, setAllLessons] = useState([]);
  const [loading, setLoading] = useState(false);

  // Filters
  const [onlyMine, setOnlyMine] = useState(false);
  const [statusFilter, setStatusFilter] = useState(&quot;all&quot;);
  const [q, setQ] = useState(&quot;&quot;);

  // Snackbar notifications
  const [snack, setSnack] = useState({ open: false, msg: &quot;&quot;, sev: &quot;info&quot; });
  const notify = (msg, sev = &quot;info&quot;) =&gt; setSnack({ open: true, msg, sev });

  // NEW: Recurring dialog visibility
  const [openRecurring, setOpenRecurring] = useState(false);

  // Helpers
  const sortByStart = (arr) =&gt;
    [...arr].sort((a, b) =&gt; new Date(a.date).getTime() - new Date(b.date).getTime());

  // Fetch lessons
  const loadLessons = async (mine = onlyMine) =&gt; {
    setLoading(true);
    try {
      const res = mine ? await getMyLessons() : await getLessons();
      const data = mine ? res.data?.lessons || [] : res.data || [];
      setAllLessons(sortByStart(data));
    } catch (e) {
      notify(&quot;Failed to load lessons.&quot;, &quot;error&quot;);
      console.error(e);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() =&gt; {
    loadLessons();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [onlyMine]);

  // Client-side filter: status + quick search
  const lessons = useMemo(() =&gt; {
    let list = allLessons;
    if (statusFilter !== &quot;all&quot;) list = list.filter((l) =&gt; l.status === statusFilter);
    if (q.trim()) {
      const needle = q.toLowerCase();
      list = list.filter((l) =&gt; {
        const teacher = l.teacherId?.name || l.teacherId?.email || &quot;&quot;;
        const student = l.studentId?.name || l.studentId?.email || &quot;&quot;;
        return (
          (l.title || &quot;&quot;).toLowerCase().includes(needle) ||
          teacher.toLowerCase().includes(needle) ||
          student.toLowerCase().includes(needle)
        );
      });
    }
    return list;
  }, [allLessons, statusFilter, q]);

  // Create/Edit state
  const [form, setForm] = useState({
    title: &quot;&quot;,
    date: toLocalDatetimeInputValue(),
    duration: 60,
    status: &quot;scheduled&quot;,
    studentId: &quot;&quot;,
  });
  const [editingId, setEditingId] = useState(null);

  const handleChange = (e) =&gt; {
    const { name, value } = e.target;
    setForm((f) =&gt; ({ ...f, [name]: value }));
  };

  const resetForm = () =&gt;
    setForm((f) =&gt; ({
      ...f,
      title: &quot;&quot;,
      date: toLocalDatetimeInputValue(),
      duration: 60,
      status: &quot;scheduled&quot;,
      studentId: &quot;&quot;,
    }));

  // Create single lesson
  const handleCreate = async (e) =&gt; {
    e.preventDefault();
    const payload = {
      title: form.title,
      date: form.date,
      duration: Number(form.duration),
      status: form.status,
      studentId: form.studentId || undefined,
    };
    try {
      const res = await createLesson(payload);
      setAllLessons((prev) =&gt; sortByStart([...prev, res.data]));
      resetForm();
      notify(&quot;Lesson created ✔️&quot;, &quot;success&quot;);
    } catch (err) {
      const msg =
        err.response?.status === 409
          ? err.response?.data?.message || &quot;Overlapping booking.&quot;
          : err.response?.data?.message ||
            err.response?.data?.error ||
            &quot;Failed to create lesson.&quot;;
      notify(msg, &quot;error&quot;);
      console.error(err);
    }
  };

  // Delete lesson
  const handleDelete = async (id) =&gt; {
    try {
      await deleteLesson(id);
      setAllLessons((prev) =&gt; prev.filter((l) =&gt; l._id !== id));
      notify(&quot;Lesson deleted&quot;, &quot;success&quot;);
    } catch (err) {
      notify(&quot;Failed to delete lesson.&quot;, &quot;error&quot;);
      console.error(err);
    }
  };

  // Toggle completed status (completed &lt;-&gt; scheduled)
  const toggleComplete = async (lesson) =&gt; {
    const newStatus = lesson.status === &quot;completed&quot; ? &quot;scheduled&quot; : &quot;completed&quot;;
    const payload = { status: newStatus };
    if (newStatus === &quot;completed&quot;) payload.attended = true;

    try {
      const res = await updateLesson(lesson._id, payload);
      setAllLessons((prev) =&gt; prev.map((l) =&gt; (l._id === lesson._id ? res.data : l)));
      notify(&quot;Lesson updated&quot;, &quot;success&quot;);
    } catch (err) {
      notify(&quot;Failed to update lesson.&quot;, &quot;error&quot;);
      console.error(err);
    }
  };

  // Toggle attended flag
  const toggleAttended = async (lesson) =&gt; {
    try {
      const res = await updateLesson(lesson._id, { attended: !lesson.attended });
      setAllLessons((prev) =&gt; prev.map((l) =&gt; (l._id === lesson._id ? res.data : l)));
      notify(`Attendance ${!lesson.attended ? &quot;marked&quot; : &quot;cleared&quot;}`, &quot;success&quot;);
    } catch (err) {
      notify(&quot;Failed to update attendance.&quot;, &quot;error&quot;);
      console.error(err);
    }
  };

  // Start editing
  const toEdit = (lesson) =&gt; {
    setEditingId(lesson._id);
    setForm({
      title: lesson.title || &quot;&quot;,
      date: toLocalDatetimeInputValue(new Date(lesson.date)),
      duration: lesson.duration || 60,
      status: lesson.status || &quot;scheduled&quot;,
      studentId: lesson.studentId?._id || lesson.studentId || &quot;&quot;,
    });
    window.scrollTo({ top: 0, behavior: &quot;smooth&quot; });
  };

  // Save edits
  const saveEdit = async (e) =&gt; {
    e.preventDefault();
    try {
      const res = await updateLesson(editingId, {
        title: form.title,
        date: form.date,
        duration: Number(form.duration),
        status: form.status,
        studentId: form.studentId || undefined,
      });
      setAllLessons((prev) =&gt; prev.map((l) =&gt; (l._id === editingId ? res.data : l)));
      setEditingId(null);
      resetForm();
      notify(&quot;Lesson saved ✔️&quot;, &quot;success&quot;);
    } catch (err) {
      const msg =
        err.response?.status === 409
          ? err.response?.data?.message || &quot;Overlapping booking.&quot;
          : err.response?.data?.message ||
            err.response?.data?.error ||
            &quot;Failed to save lesson.&quot;;
      notify(msg, &quot;error&quot;);
      console.error(err);
    }
  };

  // When recurring create finishes
  const handleRecurringCreated = (result) =&gt; {
    // Expect result like: { created: [...], skipped: [...] }
    const created = Array.isArray(result?.created) ? result.created : [];
    const skipped = Array.isArray(result?.skipped) ? result.skipped : [];
    if (created.length) {
      setAllLessons((prev) =&gt; sortByStart([...prev, ...created]));
    }
    notify(
      `Created ${created.length} lessons${skipped.length ? `, skipped ${skipped.length}` : &quot;&quot;}.`,
      &quot;success&quot;
    );
    // If your server returns partial shapes, you can call loadLessons() instead:
    // loadLessons();
  };

  // ---------------------------------------------------------------------------
  // Render
  // ---------------------------------------------------------------------------
  return (
    &lt;Box&gt;
      {/* Page title + quick actions */}
      &lt;Stack direction=&quot;row&quot; alignItems=&quot;center&quot; justifyContent=&quot;space-between&quot; sx={{ mb: 1 }}&gt;
        &lt;Typography variant=&quot;h5&quot;&gt;Manage Lessons&lt;/Typography&gt;
        {(role === &quot;teacher&quot; || role === &quot;admin&quot;) &amp;&amp; (
          &lt;Button variant=&quot;contained&quot; onClick={() =&gt; setOpenRecurring(true)}&gt;
            Add Recurring
          &lt;/Button&gt;
        )}
      &lt;/Stack&gt;

      {/* Filters */}
      &lt;Paper sx={{ p: 2, mb: 3 }}&gt;
        &lt;Grid container spacing={2} alignItems=&quot;center&quot;&gt;
          &lt;Grid item&gt;
            &lt;FormControlLabel
              control={
                </code></pre></div><div class="py-4"><p class="text-gray-600">client\src\pages\ManageLessons.jsx (Line 676:15 - Line 722:7), client\src\pages\MyLessons.jsx (Line 259:3 - Line 292:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn1" onclick="toggleCodeBlock('cloneGroup1', 'expandBtn1', 'collapseBtn1')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn1" onclick="toggleCodeBlock('cloneGroup1', 'expandBtn1', 'collapseBtn1')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup1"><code class="language-javascript text-sm text-gray-800">}
              label=&quot;Only my lessons&quot;
            /&gt;
          &lt;/Grid&gt;

          &lt;Grid item&gt;
            &lt;FormControl size=&quot;small&quot; sx={{ minWidth: 180 }}&gt;
              &lt;InputLabel id=&quot;status-label&quot;&gt;Status&lt;/InputLabel&gt;
              &lt;Select
                labelId=&quot;status-label&quot;
                label=&quot;Status&quot;
                value={statusFilter}
                onChange={(e) =&gt; setStatusFilter(e.target.value)}
              &gt;
                &lt;MenuItem value=&quot;all&quot;&gt;All&lt;/MenuItem&gt;
                &lt;MenuItem value=&quot;scheduled&quot;&gt;Scheduled&lt;/MenuItem&gt;
                &lt;MenuItem value=&quot;completed&quot;&gt;Completed&lt;/MenuItem&gt;
                &lt;MenuItem value=&quot;cancelled&quot;&gt;Cancelled&lt;/MenuItem&gt;
              &lt;/Select&gt;
            &lt;/FormControl&gt;
          &lt;/Grid&gt;

          &lt;Grid item sx={{ flexGrow: 1 }} xs={12} md=&quot;auto&quot;&gt;
            &lt;TextField
              size=&quot;small&quot;
              label=&quot;Search (title / teacher / student)&quot;
              value={q}
              onChange={(e) =&gt; setQ(e.target.value)}
              fullWidth
            /&gt;
          &lt;/Grid&gt;

          &lt;Grid item&gt;
            &lt;Button variant=&quot;outlined&quot; onClick={() =&gt; loadLessons()}&gt;
              Refresh
            &lt;/Button&gt;
          &lt;/Grid&gt;
        &lt;/Grid&gt;

        &lt;Typography variant=&quot;body2&quot; sx={{ mt: 1, opacity: 0.7 }}&gt;
          Showing {lessons.length} of {allLessons.length}
        &lt;/Typography&gt;
      &lt;/Paper&gt;

      {/* Pending Requests (teacher/admin) */}
      &lt;PendingRequests
        notify={notify</code></pre></div><div class="py-4"><p class="text-gray-600">client\src\pages\ManageLessons.jsx (Line 816:17 - Line 866:2), client\src\pages\MyLessons.jsx (Line 279:2 - Line 325:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn2" onclick="toggleCodeBlock('cloneGroup2', 'expandBtn2', 'collapseBtn2')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn2" onclick="toggleCodeBlock('cloneGroup2', 'expandBtn2', 'collapseBtn2')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup2"><code class="language-javascript text-sm text-gray-800">}}
              &gt;
                Cancel
              &lt;/Button&gt;
            )}
          &lt;/Stack&gt;
        &lt;/Box&gt;
      &lt;/Paper&gt;

      {/* Lessons list */}
      {loading ? (
        &lt;Stack direction=&quot;row&quot; alignItems=&quot;center&quot; spacing={1}&gt;
          &lt;CircularProgress size={20} /&gt;
          &lt;Typography variant=&quot;body2&quot;&gt;Loading…&lt;/Typography&gt;
        &lt;/Stack&gt;
      ) : (
        &lt;Grid container spacing={2}&gt;
          {lessons.map((lesson) =&gt; (
            &lt;Grid item xs={12} md={6} key={lesson._id}&gt;
              &lt;LessonCard
                lesson={lesson}
                onEdit={toEdit}
                onToggleComplete={toggleComplete}
                onToggleAttended={toggleAttended}
                onDelete={handleDelete}
              /&gt;
            &lt;/Grid&gt;
          ))}
        &lt;/Grid&gt;
      )}

      {/* NEW: Recurring dialog */}
      &lt;RecurringLessonDialog
        open={openRecurring}
        onClose={() =&gt; setOpenRecurring(false)}
        onCreated={handleRecurringCreated}
        defaultTeacherId={role === &quot;teacher&quot; ? currentUserId : &quot;&quot;}
      /&gt;

      {/* Snackbar */}
      &lt;Snackbar
        open={snack.open}
        autoHideDuration={3000}
        onClose={() =&gt; setSnack((s) =&gt; ({ ...s, open: false }))}
        anchorOrigin={{ vertical: &quot;bottom&quot;, horizontal: &quot;center&quot; }}
      &gt;
        &lt;Alert
          onClose={() =&gt; setSnack((s) =&gt; ({ ...s, open: false }))}
          severity={snack.sev}
          variant=&quot;filled&quot;
          sx={{ width: &quot;100%&quot; }}</code></pre></div><div class="py-4"><p class="text-gray-600">client\src\pages\Home.jsx (Line 120:4 - Line 154:11), client\src\pages\Home.jsx (Line 85:3 - Line 120:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn6" onclick="toggleCodeBlock('cloneGroup6', 'expandBtn6', 'collapseBtn6')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn6" onclick="toggleCodeBlock('cloneGroup6', 'expandBtn6', 'collapseBtn6')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup6"><code class="language-javascript text-sm text-gray-800">: 2 }} /&gt;

          &lt;Stack
            direction={{ xs: &quot;column&quot;, sm: &quot;row&quot; }}
            spacing={2}
            alignItems={{ xs: &quot;stretch&quot;, sm: &quot;center&quot; }}
            justifyContent=&quot;space-between&quot;
          &gt;
            &lt;Box&gt;
              &lt;Typography variant=&quot;subtitle1&quot; sx={{ fontWeight: 600 }}&gt;
                Chat &amp; Messages
              &lt;/Typography&gt;
              &lt;Typography variant=&quot;body2&quot; color=&quot;text.secondary&quot;&gt;
                Start a private chat from Users, or open course chat from a course page.
              &lt;/Typography&gt;
            &lt;/Box&gt;
            &lt;Stack direction=&quot;row&quot; spacing={1}&gt;
              &lt;Button
                component={RouterLink}
                to=&quot;/users&quot;
                variant=&quot;outlined&quot;
                size=&quot;small&quot;
              &gt;
                Browse Users
              &lt;/Button&gt;
              &lt;Button
                component={RouterLink}
                to=&quot;/courses&quot;
                variant=&quot;outlined&quot;
                size=&quot;small&quot;
              &gt;
                Course Chat
              &lt;/Button&gt;
              &lt;Button
                component={RouterLink</code></pre></div><div class="py-4"><p class="text-gray-600">client\src\pages\Analytics.jsx (Line 205:2 - Line 261:2), client\src\pages\Reports.jsx (Line 58:2 - Line 63:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn7" onclick="toggleCodeBlock('cloneGroup7', 'expandBtn7', 'collapseBtn7')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn7" onclick="toggleCodeBlock('cloneGroup7', 'expandBtn7', 'collapseBtn7')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup7"><code class="language-javascript text-sm text-gray-800">}
          /&gt;
          &lt;Typography variant=&quot;body2&quot;&gt;
            {item.label}:{&quot; &quot;}
            &lt;strong&gt;
              {
                (() =&gt; {
                  const v = lastValue(item.key);
                  if (v === &quot;—&quot;) return &quot;—&quot;;
                  try {
                    return item.format(v);
                  } catch {
                    return v;
                  }
                })()
              }
            &lt;/strong&gt;
          &lt;/Typography&gt;
        &lt;/Stack&gt;
      ))}
    &lt;/Stack&gt;
  );

  // ---- CSV export ----
  const toCsv = (rows) =&gt; {
    const header = [&quot;bucket&quot;, &quot;lessons&quot;, &quot;approvals&quot;, &quot;attendance_pct&quot;, &quot;avg_rating&quot;];
    const lines = [header.join(&quot;,&quot;)];
    rows.forEach((r) =&gt; {
      const attPct = r.attendance != null ? Math.round(r.attendance * 100) : &quot;&quot;;
      const rating = r.rating != null ? Number(r.rating).toFixed(1) : &quot;&quot;;
      lines.push([r.bucket, r.lessons ?? &quot;&quot;, r.approvals ?? &quot;&quot;, attPct, rating].join(&quot;,&quot;));
    });
    return lines.join(&quot;\n&quot;);
  };
  const exportCsv = () =&gt; {
    const csv = toCsv(rows);
    const blob = new Blob([csv], { type: &quot;text/csv;charset=utf-8&quot; });
    const url = URL.createObjectURL(blob);
    const r = res?.range || { from, to, bucket };
    const name = `analytics_${String(r.from).slice(0, 10)}_${String(r.to).slice(0, 10)}_${r.bucket}.csv`;
    const a = document.createElement(&quot;a&quot;);
    a.href = url;
    a.download = name;
    a.click();
    URL.revokeObjectURL(url);
  };

  // ---- Render ----
  return (
    &lt;Box sx={{ maxWidth: 1100, mx: &quot;auto&quot;, p: 2 }}&gt;
      &lt;Typography variant=&quot;h5&quot; sx={{ mb: 2 }}&gt;
        Reports &amp; Analytics
      &lt;/Typography&gt;

      {/* Filters */}
      &lt;Stack direction=&quot;row&quot; spacing={2} useFlexGap flexWrap=&quot;wrap&quot; sx={{ mb: 2 }}&gt;
        &lt;TextField type=&quot;date&quot; label=&quot;From&quot; size=&quot;small&quot; value={from} onChange={(</code></pre></div><div class="py-4"><p class="text-gray-600">client\src\pages\Analytics.jsx (Line 380:4 - Line 404:2), client\src\pages\Analytics.jsx (Line 376:2 - Line 393:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn8" onclick="toggleCodeBlock('cloneGroup8', 'expandBtn8', 'collapseBtn8')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn8" onclick="toggleCodeBlock('cloneGroup8', 'expandBtn8', 'collapseBtn8')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup8"><code class="language-javascript text-sm text-gray-800"> }}&gt;
              {lessonsTotal}
            &lt;/Typography&gt;
          &lt;/Paper&gt;
        &lt;/Grid&gt;
        &lt;Grid item xs={12} sm={4}&gt;
          &lt;Paper variant=&quot;outlined&quot; sx={{ p: 2 }}&gt;
            &lt;Typography variant=&quot;overline&quot;&gt;Approvals (total)&lt;/Typography&gt;
            &lt;Typography variant=&quot;h5&quot; sx={{ mt: 0.5 }}&gt;
              {approvalsTotal}
            &lt;/Typography&gt;
          &lt;/Paper&gt;
        &lt;/Grid&gt;
        &lt;Grid item xs={12} sm={4}&gt;
          &lt;Paper variant=&quot;outlined&quot; sx={{ p: 2 }}&gt;
            &lt;Typography variant=&quot;overline&quot;&gt;Attendance (avg)&lt;/Typography&gt;
            &lt;Typography variant=&quot;h5&quot; sx={{ mt: 0.5 }}&gt;
              {attendanceAvgPct == null ? &quot;N/A&quot; : `${attendanceAvgPct}%`}
            &lt;/Typography&gt;
          &lt;/Paper&gt;
        &lt;/Grid&gt;
      &lt;/Grid&gt;

      {/* Stats row */}
      &lt;Grid container spacing={2</code></pre></div><div class="py-4"><p class="text-gray-600">client\src\pages\Analytics.jsx (Line 404:4 - Line 438:2), client\src\pages\Analytics.jsx (Line 376:4 - Line 393:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn9" onclick="toggleCodeBlock('cloneGroup9', 'expandBtn9', 'collapseBtn9')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn9" onclick="toggleCodeBlock('cloneGroup9', 'expandBtn9', 'collapseBtn9')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup9"><code class="language-javascript text-sm text-gray-800">: 2 }}&gt;
        &lt;Grid item xs={12} sm={4}&gt;
          &lt;Paper variant=&quot;outlined&quot; sx={{ p: 2 }}&gt;
            &lt;Typography variant=&quot;overline&quot;&gt;Avg Rating&lt;/Typography&gt;
            &lt;Typography variant=&quot;h5&quot; sx={{ mt: 0.5 }}&gt;
              {ratingAvg == null ? &quot;N/A&quot; : `${ratingAvg} / 5`}
            &lt;/Typography&gt;
            &lt;Typography variant=&quot;caption&quot; color=&quot;text.secondary&quot;&gt;
              {ratingCount} feedbacks
            &lt;/Typography&gt;
          &lt;/Paper&gt;
        &lt;/Grid&gt;
        &lt;Grid item xs={12} sm={4}&gt;
          &lt;Paper variant=&quot;outlined&quot; sx={{ p: 2 }}&gt;
            &lt;Typography variant=&quot;overline&quot;&gt;Rating Std Dev&lt;/Typography&gt;
            &lt;Typography variant=&quot;h5&quot; sx={{ mt: 0.5 }}&gt;
              {ratingStd == null ? &quot;N/A&quot; : ratingStd}
            &lt;/Typography&gt;
          &lt;/Paper&gt;
        &lt;/Grid&gt;
        &lt;Grid item xs={12} sm={4}&gt;
          &lt;Paper variant=&quot;outlined&quot; sx={{ p: 2 }}&gt;
            &lt;Typography variant=&quot;overline&quot;&gt;Attendance Std Dev&lt;/Typography&gt;
            &lt;Typography variant=&quot;h5&quot; sx={{ mt: 0.5 }}&gt;
              {attStdPct == null ? &quot;N/A&quot; : `${attStdPct}%`}
            &lt;/Typography&gt;
            &lt;Typography variant=&quot;caption&quot; color=&quot;text.secondary&quot;&gt;
              {attCount} completed lessons
            &lt;/Typography&gt;
          &lt;/Paper&gt;
        &lt;/Grid&gt;
      &lt;/Grid&gt;

      {/* Time-series with Brush (zoom) */}
      &lt;Paper variant=&quot;outlined&quot; sx={{</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="jsx-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">jsx</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">client\src\pages\ManageLessons.jsx (Line 11:1 - Line 37:15), client\src\pages\MyLessons.jsx (Line 2:1 - Line 9:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn3" onclick="toggleCodeBlock('cloneGroup3', 'expandBtn3', 'collapseBtn3')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn3" onclick="toggleCodeBlock('cloneGroup3', 'expandBtn3', 'collapseBtn3')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup3"><code class="language-jsx text-sm text-gray-800">import { useEffect, useMemo, useState } from &quot;react&quot;;
import {
  Paper,
  Stack,
  Typography,
  TextField,
  Button,
  Divider,
  Chip,
  Snackbar,
  Alert,
  Tooltip,
  FormControlLabel,
  Checkbox,
  MenuItem,
  Select,
  InputLabel,
  FormControl,
  Box,
  Grid,
  Card,
  CardContent,
  CardActions,
  CircularProgress,
} from &quot;@mui/material&quot;;

// Lessons API</code></pre></div><div class="py-4"><p class="text-gray-600">client\src\pages\ManageLessons.jsx (Line 396:2 - Line 434:81), client\src\pages\MyLessons.jsx (Line 52:3 - Line 74:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn4" onclick="toggleCodeBlock('cloneGroup4', 'expandBtn4', 'collapseBtn4')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn4" onclick="toggleCodeBlock('cloneGroup4', 'expandBtn4', 'collapseBtn4')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup4"><code class="language-jsx text-sm text-gray-800">}
      &lt;/CardContent&gt;

      &lt;CardActions sx={{ px: 2, pb: 2 }}&gt;
        &lt;Tooltip title={isPast ? &quot;Past lessons can’t be edited&quot; : &quot;&quot;} disableHoverListener={!isPast}&gt;
          &lt;span&gt;
            &lt;Button size=&quot;small&quot; variant=&quot;outlined&quot; onClick={() =&gt; onEdit(lesson)} disabled={isPast}&gt;
              Edit
            &lt;/Button&gt;
          &lt;/span&gt;
        &lt;/Tooltip&gt;

        &lt;Tooltip title={isPast ? &quot;Past lessons can’t be edited&quot; : &quot;&quot;} disableHoverListener={!isPast}&gt;
          &lt;span&gt;
            &lt;Button size=&quot;small&quot; onClick={() =&gt; onToggleComplete(lesson)} disabled={isPast}&gt;
              {lesson.status === &quot;completed&quot; ? &quot;Mark Scheduled&quot; : &quot;Mark Completed&quot;}
            &lt;/Button&gt;
          &lt;/span&gt;
        &lt;/Tooltip&gt;

        &lt;Button size=&quot;small&quot; variant=&quot;outlined&quot; onClick={() =&gt; onToggleAttended(lesson)}&gt;
          {lesson.attended ? &quot;Unmark Attended&quot; : &quot;Mark Attended&quot;}
        &lt;/Button&gt;

        &lt;Tooltip title={isPast ? &quot;Past lessons can’t be deleted&quot; : &quot;&quot;} disableHoverListener={!isPast}&gt;
          &lt;span&gt;
            &lt;Button size=&quot;small&quot; color=&quot;error&quot; onClick={() =&gt; onDelete(lesson._id)} disabled={isPast}&gt;
              Delete
            &lt;/Button&gt;
          &lt;/span&gt;
        &lt;/Tooltip&gt;
      &lt;/CardActions&gt;
    &lt;/Card&gt;
  );
}

/* =============================================================================
   Page: ManageLessons
============================================================================= */</code></pre></div><div class="py-4"><p class="text-gray-600">client\src\pages\ManageLessons.jsx (Line 825:7 - Line 847:2), client\src\pages\MyLessons.jsx (Line 290:7 - Line 312:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn5" onclick="toggleCodeBlock('cloneGroup5', 'expandBtn5', 'collapseBtn5')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn5" onclick="toggleCodeBlock('cloneGroup5', 'expandBtn5', 'collapseBtn5')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup5"><code class="language-jsx text-sm text-gray-800">{/* Lessons list */}
      {loading ? (
        &lt;Stack direction=&quot;row&quot; alignItems=&quot;center&quot; spacing={1}&gt;
          &lt;CircularProgress size={20} /&gt;
          &lt;Typography variant=&quot;body2&quot;&gt;Loading…&lt;/Typography&gt;
        &lt;/Stack&gt;
      ) : (
        &lt;Grid container spacing={2}&gt;
          {lessons.map((lesson) =&gt; (
            &lt;Grid item xs={12} md={6} key={lesson._id}&gt;
              &lt;LessonCard
                lesson={lesson}
                onEdit={toEdit}
                onToggleComplete={toggleComplete}
                onToggleAttended={toggleAttended}
                onDelete={handleDelete}
              /&gt;
            &lt;/Grid&gt;
          ))}
        &lt;/Grid&gt;
      )}

      {</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div></section><!-- Add more sections for other formats and clone groups as needed--></main><footer class="bg-white shadow mt-8 py-4"><div class="container mx-auto px-4 text-center"><p class="text-sm text-gray-600">This report is generated by jscpd, an open-source copy/paste detector.</p><p class="text-sm text-gray-600">jscpd is licensed under the MIT License.</p><a class="text-blue-500 text-sm" href="https://github.com/kucherenko/jscpd" target="_blank" rel="noopener noreferrer">View jscpd on GitHub</a></div></footer><script src="js/prism.js"></script><script>function toggleCodeBlock(codeBlockId, expandBtnId, collapseBtnId) {
  const codeBlock = document.getElementById(codeBlockId);
  const expandBtn = document.getElementById(expandBtnId);
  const collapseBtn = document.getElementById(collapseBtnId);

  codeBlock.classList.toggle('hidden');
  expandBtn.classList.toggle('hidden');
  collapseBtn.classList.toggle('hidden');
}</script></body></html>